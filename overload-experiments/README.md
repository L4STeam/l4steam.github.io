# Overload experiments on dualpi2

This directory contains sample tests to highlight the behavior of dualpi2
when oversubscribed (i.e., overloaded).

These aim to provide simpler visualization than those normally used in, e.g.,
in the [DCttH paper](https://www.bobbriscoe.net/projects/latency/dctth_preprint.pdf).

## Usage

`sudo ./testrunner.py [-c results/new_run]`

This will runs the tests, and generate the corresponding plots.

See for example:
 * [results/100M_20ms_classic_protection_0](results/100M_20ms_classic_protection_0) For a run _without_ the classic protection (i.e., reserved bandwidth for the classic queue).
 * [results/100M_20ms_classic_protection_10](results/100M_20ms_classic_protection_10) For a run with 10% of the bandwidth reserver for the classic queue.
 * [results/100M_20ms_classic_protection_25](results/100M_20ms_classic_protection_25) For a run with 25% of the bandwidth reserver for the classic queue.

## Dependencies

These scripts must run on a kernel supporting TCP Prague, such as those that
can be built from the [L4S kernel tree](https://github.com/L4STeam/linux). Note that you can grab pre-built images in the artifacts of the "Actions" tab. If you build your own kernel, make sure to enable the support for network namespaces, veth pairs, virtual bridge, ...

Additionally, the host machine should have installed:
* python3
* matplotlib (e.g., `apt-get install python3-matplotlib`)
* iperf3 (e.g., `apt-get install iperf3`)
* libpcap and its development header (e.g., `sudo apt-get install libpcap-dev libpcap`)

## Layout

 * [testrunner.py](testrunner.py) This is the main script. It will execute test sessions and plot the results. See the output of `./testrunner.py -h` to tweak its behavior, e.g., with the `-c` switch to specify where should (intermediate) results be stored.
 * [test_bottleneck.sh](test_bottleneck.sh) This script takes care of setting up a virtual network connecting two pairs of hosts, crossing a common bottleneck. You should not need to execute it directly.
 * [results/](results) This directory contains results generated by previous runs.
 * [modules/](modules) This directory contains a slightly modified version of `dualpi2`, which encodes in the IP ID field of packet its sojourn time in the AQM.
 * [qdelay_dump/](qdelay_dump) This directory contains a small utility to capture and read out the queue delays of packets received on an interface.
